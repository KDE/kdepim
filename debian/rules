#! /usr/bin/make -f

include debian/kde.mk
include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/rules/simple-patchsys.mk
include /usr/share/cdbs/1/rules/utils.mk

DEB_KDE_CVS_MAKE := yes
#DEB_KDE_ENABLE_FINAL := yes
DEB_KDE_APIDOX := yes

DEB_CONFIGURE_EXTRA_FLAGS := --enable-shared --enable-static

post-patches:: debian/stamp-libtool-update debian/stamp-karm-doc-uu \
	debian/stamp-kontact-icons-uu

debian/stamp-libtool-update:
	cp -f /usr/share/libtool/libtool.m4 admin/libtool.m4.in
	cp -f /usr/share/libtool/ltmain.sh admin/ltmain.sh
	touch debian/stamp-libtool-update

debian/stamp-karm-doc-uu:
	if test -f debian/patches/karm_doc.tar.gz.uu; then \
		uudecode -o - debian/patches/karm_doc.tar.gz.uu | tar xfz -; \
	fi
	touch debian/stamp-karm-doc-uu

debian/stamp-kontact-icons-uu:
	if test -f debian/patches/kontact_icons.tar.gz.uu; then \
		uudecode -o - debian/patches/kontact_icons.tar.gz.uu | tar xfz -; \
	fi
	touch debian/stamp-kontact-icons-uu

#common-build-arch:: debian/stamp-man-pages
debian/stamp-man-pages:
# Generate man pages for the programs
	for f in debian/man/*.man; do \
		soelim -Idebian/man $$f \
		 >debian/man/`basename $$f .man`.1; \
	done
	touch debian/stamp-man-pages

clean::
	rm -f debian/man/*.6
	if test -f debian/patches/karm_doc.tar.gz.uu; then \
		rm -f `uudecode -o - debian/patches/karm_doc.tar.gz.uu | tar tfz -`; \
	fi
	if test -f debian/patches/kontact_icons.tar.gz.uu; then \
		rm -f `uudecode -o - debian/patches/kontact_icons.tar.gz.uu | tar tfz -`; \
	fi
	rm -f debian/stamp-libtool-update debian/stamp-man-pages
	rm -f debian/stamp-karm-doc-uu debian/stamp-kontact-icons-uu
	rm -f admin/libtool.m4.in admin/ltmain.sh

DEB_INSTALL_DOCS_ALL :=

DEB_INSTALL_CHANGELOGS_ALL = $(shell for f in ChangeLog CHANGELOG CHANGES; do if test -s $(cdbs_curpkg)/$$f; then echo $(cdbs_curpkg)/$$f; break; fi; done)

DEB_DH_MAKESHLIBS_ARGS_libkcal2 := -V'libkcal2 (>= 4:3.2.92)'
DEB_DH_MAKESHLIBS_ARGS_libkdenetwork2 := -V'libkdenetwork2 (>= 4:3.2.92)'
DEB_DH_MAKESHLIBS_ARGS_libkdepim1 := -V'libkdepim1 (>= 4:3.2.92)'
DEB_DH_MAKESHLIBS_ARGS_libkgantt0 := -V'libkgantt0 (>= 4:3.2.92)'
DEB_DH_MAKESHLIBS_ARGS_libkleopatra0 := -V'libkleopatra0 (>= 4:3.2.92)'
DEB_DH_MAKESHLIBS_ARGS_libkpimexchange1 := -V'libkpimexchange1 (>= 4:3.2.92)'
DEB_DH_MAKESHLIBS_ARGS_libkpimidentities1 := -V'libkpimidentities1 (>= 4:3.2.92)'
DEB_DH_MAKESHLIBS_ARGS_libksieve0 := -V'libksieve0 (>= 4:3.2.92)'
DEB_DH_MAKESHLIBS_ARGS_libmimelib1 := -V'libmimelib1 (>= 4:3.2.92)'
DEB_DH_MAKESHLIBS_ARGS_kaddressbook := -V
DEB_DH_MAKESHLIBS_ARGS_kalarm := -V
DEB_DH_MAKESHLIBS_ARGS_kdepim-wizards := -V
DEB_DH_MAKESHLIBS_ARGS_kitchensync := -V
DEB_DH_MAKESHLIBS_ARGS_kleopatra := -V
DEB_DH_MAKESHLIBS_ARGS_kmail := -V
DEB_DH_MAKESHLIBS_ARGS_knode := -V
DEB_DH_MAKESHLIBS_ARGS_knotes := -V
DEB_DH_MAKESHLIBS_ARGS_kontact := -V
DEB_DH_MAKESHLIBS_ARGS_korganizer := -V
DEB_DH_MAKESHLIBS_ARGS_kpilot := -V
DEB_DH_MAKESHLIBS_ARGS_ksync := -V
DEB_DH_MAKESHLIBS_ARGS_ktnef := -V

DEB_SHLIBDEPS_INCLUDE := \
	debian/kaddressbook/usr/lib \
	debian/kalarm/usr/lib \
	debian/kdepim-wizards/usr/lib \
	debian/kitchensync/usr/lib \
	debian/kleopatra/usr/lib \
	debian/kmail/usr/lib \
	debian/knode/usr/lib \
	debian/knotes/usr/lib \
	debian/kontact/usr/lib \
	debian/korganizer/usr/lib \
	debian/kpilot/usr/lib \
	debian/ksync/usr/lib \
	debian/ktnef/usr/lib \
	debian/libkcal2/usr/lib \
	debian/libkdenetwork2/usr/lib \
	debian/libkdepim1/usr/lib \
	debian/libkgantt0/usr/lib \
	debian/libkleopatra0/usr/lib \
	debian/libkpimexchange1/usr/lib \
	debian/libkpimidentities1/usr/lib \
	debian/libksieve0/usr/lib \
	debian/libmimelib1/usr/lib
