#MIN_CONFIG

dnl Say what we're doing
AC_MSG_CHECKING(if egroupware resource is allowed)
AC_ARG_ENABLE(caldav, [  --disable-egroupware	  disable egroupware support ],  with_egroupware=$enableval, with_egroupware=yes)
if test "$with_egroupware" = "yes"; then
    AC_MSG_RESULT([yes])
    AM_CONDITIONAL(include_egroupware_SUBDIR, test true = true)
else
    AC_MSG_RESULT([no])
    AM_CONDITIONAL(include_egroupware_SUBDIR, test true = false)
fi

dnl Say what we're doing
AC_MSG_CHECKING(if kolab resource is allowed)
AC_ARG_ENABLE(caldav, [  --disable-kolab	  disable kolab support ],  with_kolab=$enableval, with_kolab=yes)
if test "$with_kolab" = "yes"; then
    AC_MSG_RESULT([yes])
    AM_CONDITIONAL(include_kolab_SUBDIR, test true = true)
else
    AC_MSG_RESULT([no])
    AM_CONDITIONAL(include_kolab_SUBDIR, test true = false)
fi

dnl Say what we're doing
AC_MSG_CHECKING(if slox resource is allowed)
AC_ARG_ENABLE(caldav, [  --disable-slox	  disable slox support ],  with_slox=$enableval, with_slox=yes)
if test "$with_slox" = "yes"; then
    AC_MSG_RESULT([yes])
    AM_CONDITIONAL(include_slox_SUBDIR, test true = true)
else
    AC_MSG_RESULT([no])
    AM_CONDITIONAL(include_slox_SUBDIR, test true = false)
fi

dnl Say what we're doing
AC_MSG_CHECKING(if groupwise resource is allowed)
AC_ARG_ENABLE(caldav, [  --disable-groupwise	  disable groupwise support ],  with_groupwise=$enableval, with_groupwise=yes)
if test "$with_groupwise" = "yes"; then
    AC_MSG_RESULT([yes])
    AM_CONDITIONAL(include_groupwise_SUBDIR, test true = true)
else
    AC_MSG_RESULT([no])
    AM_CONDITIONAL(include_groupwise_SUBDIR, test true = false)
fi

dnl Say what we're doing
AC_MSG_CHECKING(if featureplan resource is allowed)
AC_ARG_ENABLE(featureplan, [  --disable-featureplan	  disable featureplan support ],  with_featureplan=$enableval, with_featureplan=yes)
if test "$with_featureplan" = "yes"; then
    AC_MSG_RESULT([yes])
    AM_CONDITIONAL(include_featureplan_SUBDIR, test true = true)
else
    AC_MSG_RESULT([no])
    AM_CONDITIONAL(include_featureplan_SUBDIR, test true = false)
fi

dnl Say what we're doing
AC_MSG_CHECKING(if groupdav resource is allowed)
AC_ARG_ENABLE(groupdav, [  --disable-groupdav	  disable groupdav support ],  with_groupdav=$enableval, with_groupdav=yes)
if test "$with_groupdav" = "yes"; then
    AC_MSG_RESULT([yes])
    AM_CONDITIONAL(include_groupdav_SUBDIR, test true = true)
else
    AC_MSG_RESULT([no])
    AM_CONDITIONAL(include_groupdav_SUBDIR, test true = false)
fi

dnl Say what we're doing
AC_MSG_CHECKING(if birthdays resource is allowed)
AC_ARG_ENABLE(birthdays, [  --disable-birthdays	  disable birthdays support ],  with_birthdays=$enableval, with_birthdays=yes)
if test "$with_birthdays" = "yes"; then
    AC_MSG_RESULT([yes])
    AM_CONDITIONAL(include_birthdays_SUBDIR, test true = true)
else
    AC_MSG_RESULT([no])
    AM_CONDITIONAL(include_birthdays_SUBDIR, test true = false)
fi

dnl Say what we're doing
AC_MSG_CHECKING(if newexchange resource is allowed)
AC_ARG_ENABLE(newexchange, [  --disable-newexchange	  disable newexchange support ],  with_newexchange=$enableval, with_newexchange=yes)
if test "$with_newexchange" = "yes"; then
    AC_MSG_RESULT([yes])
    AM_CONDITIONAL(include_newexchange_SUBDIR, test true = true)
else
    AC_MSG_RESULT([no])
    AM_CONDITIONAL(include_newexchange_SUBDIR, test true = false)
fi

dnl Say what we're doing
AC_MSG_CHECKING(if scalix resource is allowed)
AC_ARG_ENABLE(scalix, [  --disable-scalix	  disable scalix support ],  with_scalix=$enableval, with_scalix=yes)
if test "$with_scalix" = "yes"; then
    AC_MSG_RESULT([yes])
    AM_CONDITIONAL(include_scalix_SUBDIR, test true = true)
else
    AC_MSG_RESULT([no])
    AM_CONDITIONAL(include_scalix_SUBDIR, test true = false)
fi

dnl Say what we're doing
AC_MSG_CHECKING(if caldav resource is allowed)
AC_ARG_ENABLE(caldav, [  --disable-caldav	  disable caldav support (caldav resources such as Google Calendar and Zimbra will not function) ],  with_caldav=$enableval, with_caldav=yes)
if test "$with_caldav" = "yes"; then
    AC_MSG_RESULT([yes])

    dnl Check caldav API version
    AC_LANG_SAVE
    AC_LANG_CPLUSPLUS
    cxx_flags_safe="$CXXFLAGS"
    cflags_safe="$CFLAGS"
    CXXFLAGS="$CXXFLAGS"
    CFLAGS="$CFLAGS"
    AC_MSG_CHECKING([for libcaldav])
    AC_TRY_COMPILE([extern "C" {
    #include <libcaldav/caldav.h>
    }
    ],[return 0;],
    [AC_MSG_RESULT(found)
    AM_CONDITIONAL(include_caldav_SUBDIR, test true = true)],
    [AC_MSG_RESULT(not found)
    AM_CONDITIONAL(include_caldav_SUBDIR, test true = false)])
    CXXFLAGS="$cxx_flags_safe"
    CFLAGS="$cflags_safe"
    AC_LANG_RESTORE

else
    AC_MSG_RESULT([no])
    AM_CONDITIONAL(include_caldav_SUBDIR, test true = false)
fi

dnl Say what we're doing
AC_MSG_CHECKING(if carddav resource is allowed)
AC_ARG_ENABLE(carddav, [  --disable-carddav	  disable carddav support (carddav resources such as Google Contacts and Zimbra will not function) ],  with_carddav=$enableval, with_carddav=yes)
if test "$with_carddav" = "yes"; then
    AC_MSG_RESULT([yes])

    dnl Check carddav API version
    AC_LANG_SAVE
    AC_LANG_CPLUSPLUS
    cxx_flags_safe="$CXXFLAGS"
    cflags_safe="$CFLAGS"
    CXXFLAGS="$CXXFLAGS"
    CFLAGS="$CFLAGS"
    AC_MSG_CHECKING([for libcarddav])
    AC_TRY_COMPILE([extern "C" {
    #include <libcarddav/carddav.h>
    }
    ],[return 0;],
    [AC_MSG_RESULT(found)
    AM_CONDITIONAL(include_carddav_SUBDIR, test true = true)],
    [AC_MSG_RESULT(not found)
    AM_CONDITIONAL(include_carddav_SUBDIR, test true = false)])
    CXXFLAGS="$cxx_flags_safe"
    CFLAGS="$cflags_safe"
    AC_LANG_RESTORE

else
    AC_MSG_RESULT([no])
    AM_CONDITIONAL(include_carddav_SUBDIR, test true = false)
fi
