#MIN_CONFIG

dnl Say what we're doing
AC_MSG_CHECKING(if caldav resource is allowed)
AC_ARG_ENABLE(caldav, [  --disable-caldav	  disable caldav support (caldav resources such as Google Calendar and Zimbra will not function) ],  with_caldav=$enableval, with_caldav=yes)
if test "$with_caldav" = "yes"; then
    AC_MSG_RESULT([yes])

    dnl Check caldav API version
    AC_LANG_SAVE
    AC_LANG_CPLUSPLUS
    cxx_flags_safe="$CXXFLAGS"
    cflags_safe="$CFLAGS"
    CXXFLAGS="$CXXFLAGS"
    CFLAGS="$CFLAGS"
    AC_MSG_CHECKING([for libcaldav])
    AC_TRY_COMPILE([extern "C" {
    #include <libcaldav/caldav.h>
    }
    ],[return 0;],
    [AC_MSG_RESULT(found)
    AM_CONDITIONAL(include_caldav_SUBDIR, test true = true)],
    [AC_MSG_RESULT(not found)
    AM_CONDITIONAL(include_caldav_SUBDIR, test true = false)])
    CXXFLAGS="$cxx_flags_safe"
    CFLAGS="$cflags_safe"
    AC_LANG_RESTORE

else
    AC_MSG_RESULT([no])
    AM_CONDITIONAL(include_caldav_SUBDIR, test true = false)
fi

dnl Say what we're doing
AC_MSG_CHECKING(if carddav resource is allowed)
AC_ARG_ENABLE(carddav, [  --disable-carddav	  disable carddav support (carddav resources such as Google Contacts and Zimbra will not function) ],  with_carddav=$enableval, with_carddav=yes)
if test "$with_carddav" = "yes"; then
    AC_MSG_RESULT([yes])

    dnl Check carddav API version
    AC_LANG_SAVE
    AC_LANG_CPLUSPLUS
    cxx_flags_safe="$CXXFLAGS"
    cflags_safe="$CFLAGS"
    CXXFLAGS="$CXXFLAGS"
    CFLAGS="$CFLAGS"
    AC_MSG_CHECKING([for libcarddav])
    AC_TRY_COMPILE([extern "C" {
    #include <libcarddav/carddav.h>
    }
    ],[return 0;],
    [AC_MSG_RESULT(found)
    AM_CONDITIONAL(include_carddav_SUBDIR, test true = true)],
    [AC_MSG_RESULT(not found)
    AM_CONDITIONAL(include_carddav_SUBDIR, test true = false)])
    CXXFLAGS="$cxx_flags_safe"
    CFLAGS="$cflags_safe"
    AC_LANG_RESTORE

else
    AC_MSG_RESULT([no])
    AM_CONDITIONAL(include_carddav_SUBDIR, test true = false)
fi
